<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TurnipPrice.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">OOADProject</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">TurnipPrice.java</span></div><h1>TurnipPrice.java</h1><pre class="source lang-java linenums">import java.time.LocalDateTime;
import java.util.Arrays;
import java.util.Timer;
import java.util.TimerTask;

public class TurnipPrice {
    private LocalDateTime now;
<span class="fc" id="L8">    private int currentPage = 0;</span>
<span class="fc" id="L9">    private int inputtedPrice = 0;</span>
<span class="fc" id="L10">    private int[] price = new int[]{ 0,0,0,0,0,0,0,0,0,0,0,0,0 };</span>
<span class="fc" id="L11">    private boolean[] isInputted = new boolean[13];</span>
<span class="fc" id="L12">    private boolean isSetHighestDay = false;</span>
<span class="fc" id="L13">    private TimeKeeping timeKeeping = TimeKeeping.getInstance();</span>
    private TimerTask timerTask;
    private Timer turnipThread;
    private TurnipCalc turnipCalc;

<span class="fc" id="L18">    TurnipPrice() {</span>
<span class="fc" id="L19">        this.turnipThread = new Timer();</span>
<span class="fc" id="L20">        turnipCalc = new TurnipCalc();</span>
<span class="fc" id="L21">    }</span>

    public int getTurnipPrice() {
<span class="fc" id="L24">        return price[currentPage];</span>
    }

    public void setTurnipPrice(int priceValue){ //무 값을 저장하고 인덱스 1 증가
<span class="fc" id="L28">        price[currentPage] = priceValue;</span>
<span class="fc" id="L29">        isInputted[currentPage] = true;</span>
<span class="fc" id="L30">        inputtedPrice++;</span>

<span class="pc bpc" id="L32" title="1 of 2 branches missed.">        if(inputtedPrice&gt;=5) {</span>
<span class="nc" id="L33">            System.out.println(Arrays.toString(turnipCalc.calcPrice(price, isInputted)));</span>
<span class="nc" id="L34">            price = turnipCalc.calcPrice(price,isInputted); //여기에서 calcPrice호출</span>
<span class="nc" id="L35">            setHighestDay();</span>
        }
<span class="fc" id="L37">    }</span>

    public boolean getIsSetSetHighestDay() {
<span class="nc" id="L40">        return isSetHighestDay;</span>
    }

    public String getTurnipDay() {
<span class="fc" id="L44">        String dayOfWeek[] = new String[]{&quot;sun&quot;, &quot;mon&quot;, &quot;tue&quot;, &quot;wed&quot;, &quot;thu&quot;, &quot;fri&quot;, &quot;sat&quot;};</span>
<span class="fc" id="L45">        String timeOfDay[] = new String[]{&quot;am-&quot;, &quot;pm-&quot;};</span>
<span class="fc" id="L46">        String whatDayOfWeek = timeOfDay[(currentPage+1)%2] + dayOfWeek[(currentPage+1)/2];</span>

<span class="pc bpc" id="L48" title="1 of 2 branches missed.">        if(price[currentPage] == 0){</span>
<span class="fc" id="L49">            return whatDayOfWeek + &quot;---&quot;;</span>
        }
<span class="nc bnc" id="L51" title="All 2 branches missed.">        if(isInputted[currentPage]){</span>
<span class="nc" id="L52">            return whatDayOfWeek + &quot;-in&quot;;</span>
        }else{
<span class="nc" id="L54">            return whatDayOfWeek + &quot;est&quot;;</span>
        }
    }

    public void resetPrice() {//무값 초기화
<span class="fc" id="L59">        price = new int[]{0,0,0,0,0,0,0,0,0,0,0,0,0 };</span>
<span class="fc" id="L60">        inputtedPrice = 0;</span>
<span class="fc" id="L61">        currentPage = 0;</span>
<span class="fc" id="L62">        isInputted = new boolean[13];</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">        if(isSetHighestDay) this.deactivateAlarm();</span>
<span class="fc" id="L64">    }</span>

    //0보다 크면 다음 페이지, 작으면 이전 페이지
    public void nextPrice() {
<span class="fc" id="L68">        currentPage = (currentPage+1)%13;</span>
<span class="fc" id="L69">    }</span>

    private void setHighestDay(){
<span class="nc" id="L72">        int maxDay = 0;</span>
<span class="nc" id="L73">        int maxPrice = 0;</span>
<span class="nc" id="L74">        isSetHighestDay = true;</span>

<span class="nc bnc" id="L76" title="All 2 branches missed.">        for(int i = (timeKeeping.getCurrentTime().getDayOfWeek().getValue()%7 ) * 2; i&lt;13; i++){</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">            if(price[i] &gt; maxPrice){</span>
<span class="nc" id="L78">                maxDay = i;</span>
<span class="nc" id="L79">                maxPrice = price[i];</span>
            }
        }
<span class="nc bnc" id="L82" title="All 2 branches missed.">        if (maxDay == 0) return;</span>
<span class="nc" id="L83">        int finalMaxDay = maxDay;</span>

<span class="nc" id="L85">        timerTask = new TimerTask() {</span>
            @Override
            public void run() {
<span class="nc" id="L88">            now = timeKeeping.getCurrentTime().toLocalDateTime();</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">            if (finalMaxDay % 2 == 0) {</span>
<span class="nc bnc" id="L90" title="All 8 branches missed.">                if (12 == now.getHour() &amp;&amp; (finalMaxDay + 1) / 2 == (now.getDayOfWeek().getValue()%7) &amp;&amp; 0 == now.getMinute() &amp;&amp; 0 == now.getSecond()) {</span>
<span class="nc" id="L91">                    Buzzer.reqBeep();</span>
                }
            } else {
<span class="nc bnc" id="L94" title="All 8 branches missed.">                if (9 == now.getHour() &amp;&amp; (finalMaxDay + 1) / 2 == (now.getDayOfWeek().getValue()%7)  &amp;&amp; 0 == now.getMinute() &amp;&amp; 0 == now.getSecond()) {</span>
<span class="nc" id="L95">                    Buzzer.reqBeep();</span>
                }
            }
<span class="nc" id="L98">            }</span>
        };

<span class="nc" id="L101">        turnipThread.scheduleAtFixedRate(timerTask, 0, 1000);</span>
<span class="nc" id="L102">    }</span>

    public void deactivateAlarm(){
        //Buzzer 등록된 타이머를 제거
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">        if(timerTask!=null) {</span>
<span class="nc" id="L107">            timerTask.cancel();</span>
<span class="nc" id="L108">            turnipThread.cancel();</span>
<span class="nc" id="L109">            turnipThread.purge();</span>
        }
<span class="nc" id="L111">        Buzzer.stopBeep();</span>
<span class="nc" id="L112">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>